{% extends "base.html" %}

{% block content %}
<div class="container mx-auto py-8 space-y-8">

  <h2 class="text-2xl font-bold">Analytics Overview</h2>

  <!-- KPI cards (unchanged) -->
  <div class="grid grid-cols-4 gap-6">
    <!-- … your Pageviews / Saved / Proposals / Conversion Rate cards … -->
  </div>

  <!-- Charts row with fixed-height boxes -->
  <div class="grid grid-cols-2 gap-6">
    <!-- Conversion Breakdown -->
    <div class="bg-white p-6 rounded-lg shadow h-64">
      <h3 class="text-lg font-medium mb-4">Conversion Breakdown</h3>
      <canvas id="donutChart" class="w-full h-full"></canvas>
    </div>

    <!-- Pageviews (Last 7 Days) -->
    <div class="bg-white p-6 rounded-lg shadow h-64">
      <h3 class="text-lg font-medium mb-4">Pageviews (Last 7 Days)</h3>
      <canvas id="lineChart" class="w-full h-full"></canvas>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // -- Donut chart --
  new Chart(document.getElementById('donutChart').getContext('2d'), {
    type: 'doughnut',
    data: {
      labels: ['Converted', 'Dropped'],
      datasets: [{
        data: [{{ donut_converted }}, {{ donut_dropped }}],
        backgroundColor: ['#4F46E5', '#CBD5E1']
      }]
    },
    options: {
      maintainAspectRatio: false,    // ← allow filling parent height
      plugins: { legend: { position: 'bottom' } }
    }
  });

  // -- Line chart --
  new Chart(document.getElementById('lineChart').getContext('2d'), {
    type: 'line',
    data: {
      labels: {{ line_labels|tojson }},
      datasets: [{
        label: 'Pageviews',
        data: {{ line_data|tojson }},
        tension: 0.3,
        fill: false,
        borderColor: '#4F46E5'
      }]
    },
    options: {
      maintainAspectRatio: false,    // ← allow filling parent height
      scales: {
        y: { beginAtZero: true, ticks: { stepSize: 1 } }
      }
    }
  });
</script>
{% endblock %}
