{% extends 'base.html' %}
{% block title %}Analytics · Zyberfy{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto p-6 space-y-6">
  <!-- KPI Cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
    <!-- ... your existing 4 cards ... -->
  </div>

  <!-- Conversion Rate -->
  <div class="bg-white p-6 rounded-lg shadow">
    <p class="text-sm text-gray-600">Conversion Rate</p>
    <p class="text-2xl font-semibold">{{ conversion_rate }}%</p>
  </div>

  <!-- Charts (3 across on md+) -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <!-- Donut -->
    <div class="bg-white p-4 rounded-lg shadow">
      <p class="text-sm text-gray-600 mb-2">Conversion Breakdown</p>
      <div class="h-64"><canvas id="donutChart"></canvas></div>
    </div>

    <!-- Pageviews -->
    <div class="bg-white p-4 rounded-lg shadow">
      <p class="text-sm text-gray-600 mb-2">Pageviews (Last 7 Days)</p>
      <div class="h-64"><canvas id="lineChart"></canvas></div>
    </div>

    <!-- Proposals Generated -->
    <div class="bg-white p-4 rounded-lg shadow">
      <p class="text-sm text-gray-600 mb-2">Proposals Generated (Last 7 Days)</p>
      <div class="h-64"><canvas id="genChart"></canvas></div>
    </div>
  </div>

  <a href="{{ url_for('dashboard') }}" class="inline-block text-gray-700 hover:underline">
    ← Back to Dashboard
  </a>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Donut
  new Chart(document.getElementById('donutChart'), {
    type: 'doughnut',
    data: {
      labels: ['Converted','Dropped'],
      datasets: [{ data: [{{ donut_converted }}, {{ donut_dropped }}] }]
    },
    options:{ maintainAspectRatio:false, responsive:true }
  });

  // Pageviews Line
  new Chart(document.getElementById('lineChart'), {
    type: 'line',
    data: {
      labels: {{ line_labels|tojson }},
      datasets: [{
        label: 'Pageviews',
        data: {{ line_data|tojson }},
        fill: false,
        tension: 0.1
      }]
    },
    options:{
      maintainAspectRatio:false,
      responsive:true,
      scales:{ y:{ beginAtZero:true } }
    }
  });

  // Generated Line
  new Chart(document.getElementById('genChart'), {
    type: 'line',
    data: {
      labels: {{ line_labels|tojson }},
      datasets: [{
        label: 'Generated',
        data: {{ generated_data|tojson }},
        fill: false,
        tension: 0.1
      }]
    },
    options:{
      maintainAspectRatio:false,
      responsive:true,
      scales:{ y:{ beginAtZero:true } }
    }
  });
</script>
{% endblock %}
