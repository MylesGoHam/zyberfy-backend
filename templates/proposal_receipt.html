{% extends "base.html" %}
{% block title %}Proposal View | Zyberfy{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto mt-10 p-6 bg-white rounded-xl shadow space-y-6">
  <h1 class="text-2xl font-bold text-blue-600 text-center">Proposal Receipt</h1>

  <div class="text-sm space-y-2">
    <p><strong>Name:</strong> {{ proposal.lead_name }}</p>
    <p><strong>Email:</strong> {{ proposal.lead_email }}</p>
    <p><strong>Company:</strong> {{ proposal.lead_company }}</p>
    <p><strong>Services:</strong> {{ proposal.services }}</p>
    <p><strong>Budget:</strong> {{ proposal.budget }}</p>
    <p><strong>Timeline:</strong> {{ proposal.timeline }}</p>
    <p><strong>Submitted:</strong> {{ proposal.timestamp }}</p>
  </div>

  <div class="bg-gray-50 p-4 rounded border">
    <h2 class="text-lg font-semibold mb-2">Proposal Text</h2>
    <p class="whitespace-pre-line text-sm text-gray-800">{{ proposal.proposal_text }}</p>
  </div>

  <div class="flex justify-between items-center gap-2">
    <form method="POST">
      <input type="hidden" name="action" value="approved" />
      <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Approve</button>
    </form>

    <form method="POST">
      <input type="hidden" name="action" value="declined" />
      <button type="submit" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Decline</button>
    </form>

    <button onclick="copyText()" class="bg-gray-200 px-4 py-2 rounded hover:bg-gray-300">Copy</button>
    <button onclick="window.print()" class="bg-gray-200 px-4 py-2 rounded hover:bg-gray-300">Print</button>
  </div>

  {% if proposal.status %}
  <div class="text-center mt-4">
    <span class="text-sm font-medium px-3 py-1 rounded-full
      {% if proposal.status == 'approved' %} bg-green-100 text-green-700
      {% elif proposal.status == 'declined' %} bg-red-100 text-red-700
      {% else %} bg-gray-100 text-gray-700 {% endif %}">
      Status: {{ proposal.status | capitalize }}
    </span>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
  function copyText() {
    const el = document.createElement("textarea");
    el.value = "{{ proposal.proposal_text | replace('\n', '\\n') }}";
    document.body.appendChild(el);
    el.select();
    document.execCommand("copy");
    document.body.removeChild(el);
    alert("Proposal copied to clipboard!");
  }
</script>
{% endblock %}