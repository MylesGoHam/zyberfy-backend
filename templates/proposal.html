{% extends "base.html" %}
{% block title %}Send a Proposal ‚Äì Zyberfy{% endblock %}

{% block content %}
  <!-- Load Tailwind for this page -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Wrapper for Centered Layout -->
  <div class="w-full max-w-xl mx-auto px-6">

    <!-- Top Buttons -->
    <div class="flex justify-between items-center mb-6">
      <a href="{{ url_for('dashboard') }}" class="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300 transition">
        ‚Üê Back to Dashboard
      </a>
      <button id="shareBtn" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition">
        Share this Form
      </button>{% extends "base.html" %}
{% block title %}Test Proposal Preview ‚Äì Zyberfy{% endblock %}

{% block content %}
  <style>
    .preview-body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background-color: #f9f9f9;
    }
    .preview-body h2 {
      color: #1e90ff;
    }
    .preview-body pre {
      background-color: #f4f4f4;
      padding: 1.5rem;
      border-radius: 10px;
      white-space: pre-wrap;
      word-wrap: break-word;
      border: 1px solid #ddd;
    }
    .copy-btn {
      margin-top: 1rem;
      padding: 10px 16px;
      background-color: #1e90ff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .back-link {
      display: inline-block;
      margin-top: 1rem;
      text-decoration: none;
      color: #555;
      font-size: 0.9rem;
    }
  </style>

  <div class="preview-body">
    <h2>üß† Preview: AI-Generated Proposal</h2>
    <pre id="proposal-text">{{ generated_email }}</pre>
    <button class="copy-btn" id="copyBtn">Copy to Clipboard</button><br>
    <a class="back-link" href="{{ url_for('automation_page') }}">‚Üê Back to Automation Settings</a>
  </div>
{% endblock %}

{% block scripts %}
<script>
  document.getElementById('copyBtn').addEventListener('click', () => {
    const text = document.getElementById('proposal-text').innerText;
    navigator.clipboard.writeText(text).then(() => {
      alert('Copied to clipboard!');
    });
  });
</script>
{% endblock %}
    </div>

    <!-- Proposal Form -->
    <div class="bg-white rounded-2xl shadow-lg p-8">
      <h1 class="text-2xl font-bold mb-6 text-gray-800">Send a Proposal</h1>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="mb-6">
      {% for category, msg in messages %}
        <div class="bg-green-100 text-green-800 px-4 py-3 rounded-lg border border-green-300 shadow-sm">
          {{ msg }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

      <form action="{{ url_for('proposal') }}" method="POST" class="space-y-6">
        <div>
          <label class="block mb-1 font-medium text-gray-700">Your Name</label>
          <input
            type="text"
            name="name"
            required
            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
            placeholder="e.g. Jane Doe"
          />
        </div>

        <div>
          <label class="block mb-1 font-medium text-gray-700">Your Email</label>
          <input
            type="email"
            name="email"
            required
            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
            placeholder="e.g. you@example.com"
          />
        </div>

        <div>
          <label class="block mb-1 font-medium text-gray-700">Company (Optional)</label>
          <input
            type="text"
            name="company"
            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
            placeholder="Your Company Name"
          />
        </div>

        <div>
          <label class="block mb-1 font-medium text-gray-700">Project Details</label>
          <textarea
            name="details"
            required
            rows="4"
            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
            placeholder="Describe what you need‚Äîscope, timeline, anything else..."
          ></textarea>
        </div>

        <div>
          <label class="block mb-1 font-medium text-gray-700">Budget ($)</label>
          <input
            type="number"
            name="budget"
            min="0"
            required
            class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-400"
            placeholder="e.g. 5000"
          />
        </div>

        <button
          type="submit"
          class="w-full bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700 transition"
        >
          Send Proposal
        </button>
      </form>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
  const shareBtn = document.getElementById('shareBtn');
  shareBtn.addEventListener('click', () => {
    const url = window.location.href;
    if (navigator.clipboard) {
      navigator.clipboard.writeText(url).then(() => {
        shareBtn.textContent = 'Link Copied!';
        setTimeout(() => shareBtn.textContent = 'Share this Form', 2000);
      });
    } else {
      window.location.href = `mailto:?subject=Proposal%20Form&body=Please%20fill%20out%20this%20form:%20${encodeURIComponent(url)}`;
    }
  });
</script>
{% endblock %}
