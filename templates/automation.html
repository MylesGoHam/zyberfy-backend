<!-- templates/automation.html -->
{% extends "base.html" %}
{% block title %}Automation Settings | Zyberfy{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 py-8">
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-2xl font-bold">Automation Settings</h2>
    <a href="{{ url_for('dashboard') }}" class="text-sm text-gray-500 hover:text-gray-700">&larr; Back to Dashboard</a>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="bg-green-100 border border-green-300 text-green-800 px-4 py-2 rounded mb-4">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <form method="POST" action="{{ url_for('automation') }}" class="space-y-6">
    <!-- Tone Input -->
    <div>
      <label class="block text-sm font-medium text-gray-700 mb-1">Describe your tone, personality, or voice</label>
      <textarea name="tone" rows="3"
        class="w-full p-3 border rounded-lg text-sm"
        placeholder="Ex: Friendly, luxury concierge, calm, elegant, or direct. This will help the AI write in your style.">{{ tone }}</textarea>
      <p class="text-sm text-gray-500 mt-1">Ex: Friendly, luxury concierge, calm, warm and elegant, etc.</p>
    </div>

    <!-- Toggles -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <label class="inline-flex items-center">
        <input type="checkbox" name="full_auto" class="form-checkbox" {% if full_auto %}checked{% endif %}>
        <span class="ml-2">Enable Smart Follow-ups</span>
      </label>
      <label class="inline-flex items-center">
        <input type="checkbox" name="accept_offers" class="form-checkbox" {% if accept_offers %}checked{% endif %}>
        <span class="ml-2">Auto Accept Offers</span>
      </label>
      <label class="inline-flex items-center">
        <input type="checkbox" name="reject_offers" class="form-checkbox" {% if reject_offers %}checked{% endif %}>
        <span class="ml-2">Auto Reject Low Offers</span>
      </label>
      <div>
        <label class="block text-sm font-medium text-gray-700">Proposal Length</label>
        <select name="length" class="w-full border-gray-300 rounded-lg shadow-sm">
          <option value="concise" {% if length == 'concise' %}selected{% endif %}>Concise</option>
          <option value="detailed" {% if length == 'detailed' %}selected{% endif %}>Detailed</option>
        </select>
      </div>
    </div>

    <!-- Save Button -->
    <div>
      <button type="submit" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700">Save Settings</button>
    </div>
  </form>

<!-- Collapsible Preview -->
<div class="mt-10">
  <div class="flex items-center justify-between mb-2">
    <h3 class="text-lg font-semibold">Test Output (Preview)</h3>
    <button id="toggle-preview" class="text-blue-600 text-sm hover:underline font-medium">
      Show Preview
    </button>
  </div>
  <div id="preview-box" class="bg-gray-100 rounded-lg text-sm text-gray-700 whitespace-pre-wrap p-4 transition-all duration-300 ease-in-out max-h-0 overflow-hidden">
    {{ preview or 'Click "Save Settings" to see a preview of how the AI will sound.' }}
  </div>
</div>

<!-- Toggle Script -->
{% block scripts %}
<script>
  const toggleBtn = document.getElementById("toggle-preview");
  const previewBox = document.getElementById("preview-box");

  toggleBtn.addEventListener("click", () => {
    const expanded = previewBox.classList.contains("max-h-[1000px]");
    if (expanded) {
      previewBox.classList.remove("max-h-[1000px]", "py-4", "px-4");
      previewBox.classList.add("max-h-0", "overflow-hidden");
      toggleBtn.textContent = "Show Preview";
    } else {
      previewBox.classList.remove("max-h-0", "overflow-hidden");
      previewBox.classList.add("max-h-[1000px]", "py-4", "px-4");
      toggleBtn.textContent = "Hide Preview";
    }
  });
</script>
{% endblock %}
